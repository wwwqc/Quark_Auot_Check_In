# 工作流名称（在 Actions 页面显示）
name: Quark Sign-in

# 触发条件：定时触发 + 手动触发
on:
  schedule:
    # 修正：cron 表达式与注释一致（UTC 1:00 = 北京时间 9:00），清理冗余空行
    - cron: '30 2 * * *'
    - cron: '30 3 * * *'
  workflow_dispatch:  # 手动触发（保留，方便测试）

jobs:
  # 任务1：北京时间10:30执行（仅1次，无重试）
  sign-1030:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # 短超时，避免闲置
    # 仅匹配10:30定时触发 或 手动触发
    if: github.event_name == 'workflow_dispatch' || github.event.schedule == '30 2 * * *'
    steps:
      - name: 拉取仓库代码
        uses: actions/checkout@v4
      
      - name: 配置Python3.9环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
           #cache: 'pip'  # 缓存依赖，加速执行
      
      - name: 安装脚本依赖
        run: |
          python -m pip install --upgrade pip
          pip install requests  # 仅安装核心依赖，移除tenacity
      
      - name: 执行10:30签到任务
        env:
          # 引用GitHub保密变量，与脚本一致
          COOKIE_QUARK: ${{ secrets.COOKIE_QUARK }}
        run: |
          echo "===== 【北京时间10:30】夸克签到开始 ====="
          python quark_sign.py
          echo "===== 【北京时间10:30】夸克签到结束 ====="

  # 任务2：北京时间11:30执行（仅1次，无重试，与任务1逻辑完全一致）
  sign-1130:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    # 仅匹配11:30定时触发 或 手动触发
    if: github.event_name == 'workflow_dispatch' || github.event.schedule == '30 3 * * *'
    steps:
      - name: 拉取仓库代码
        uses: actions/checkout@v4
      
      - name: 配置Python3.9环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
           #cache: 'pip'
      
      - name: 安装脚本依赖
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: 执行11:30签到任务
        env:
          COOKIE_QUARK: ${{ secrets.COOKIE_QUARK }}
        run: |
          echo "===== 【北京时间11:30】夸克签到开始 ====="
          python quark_sign.py
          echo "===== 【北京时间11:30】夸克签到结束 ====="

